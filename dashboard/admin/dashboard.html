<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Dashboard - AssistByDataTraack">
    <meta name="theme-color" content="#667eea">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">
    
    <!-- Título -->
    <title>Admin Dashboard | AssistByDataTraack</title>
    
    <!-- Preconexión -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS para mapas -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Estilos -->
    <link rel="stylesheet" href="../../css/normalize.css">
    <link rel="stylesheet" href="../shared/css/variables.css">
    <link rel="stylesheet" href="css/admin-dashboard.css">
</head>
<body>
    <!-- Loader -->
    <div id="pageLoader" class="page-loader">
        <div class="loader-spinner"></div>
        <p class="loader-text">Cargando dashboard...</p>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="../../assets/images/logo.svg" alt="Logo" class="sidebar-logo">
            <h2 class="sidebar-title">DataTraack</h2>
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                </svg>
            </button>
        </div>

        <nav class="sidebar-nav">
    <a href="#dashboard" class="nav-item active">
        <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
        </svg>
        <span>Dashboard</span>
    </a>

    <a href="https://secure.datatraack.com/dt_invoices/login/?next=/dt_invoices/" target="_blank" rel="noopener noreferrer" class="nav-item">
        <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
        </svg>
        <span>Facturación</span>
    </a>

    <a href="https://secure.datatraack.com/admin/login/?next=/admin/" target="_blank" rel="noopener noreferrer" class="nav-item">
        <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
        </svg>
        <span>Base de Datos</span>
    </a>
</nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                    </svg>
                </div>
                <div class="user-details">
                    <p class="user-name" id="userName">Admin</p>
                    <p class="user-role">Administrador</p>
                </div>
            </div>
            <button class="btn-logout" id="logoutBtn" title="Cerrar sesión">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                </svg>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                <h1 class="page-title">Dashboard</h1>
            </div>
            <div class="header-right">
                <button class="btn-refresh" id="refreshBtn" title="Actualizar datos">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                </button>
                <div class="last-update">
                    Última actualización: <span id="lastUpdate">--:--</span>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <section class="stats-section" id="statsSection">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-icon-primary">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Hoy</p>
                        <p class="stat-value" id="statToday">--</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-success">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Esta Semana</p>
                        <p class="stat-value" id="statWeek">--</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-info">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Este Mes</p>
                        <p class="stat-value" id="statMonth">--</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-warning">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Total</p>
                        <p class="stat-value" id="statTotal">--</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Filters & Search -->
        <section class="filters-section">
            <div class="filters-header">
                <h2 class="section-title">Asistencias Registradas</h2>
                <div class="filters-actions">
                    <button class="btn btn-secondary" id="exportExcelBtn">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"/>
                        </svg>
                        Excel
                    </button>
                    <button class="btn btn-secondary" id="exportCsvBtn">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"/>
                        </svg>
                        CSV
                    </button>
                </div>
            </div>

            <div class="search-bar">
                <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput" 
                    placeholder="Buscar por nombre, cliente o tienda..."
                >
            </div>

            <div class="filters-row">
                <select class="filter-select" id="filterClient">
                    <option value="">Todos los clientes</option>
                </select>
                <select class="filter-select" id="filterDate">
                    <option value="">Todas las fechas</option>
                    <option value="today">Hoy</option>
                    <option value="week">Esta semana</option>
                    <option value="month">Este mes</option>
                </select>
                <button class="btn-clear-filters" id="clearFiltersBtn">
                    Limpiar filtros
                </button>
            </div>
        </section>

        <!-- Data Table -->
        <section class="table-section">
            <div class="table-container">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th data-sort="created_at">
                                Fecha
                                <svg class="sort-icon" viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                                </svg>
                            </th>
                            <th data-sort="full_name">
                                Nombre
                                <svg class="sort-icon" viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                                </svg>
                            </th>
                            <th data-sort="client">
                                Cliente
                                <svg class="sort-icon" viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                                </svg>
                            </th>
                            <th data-sort="store_number">
                                Tienda
                                <svg class="sort-icon" viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                                </svg>
                            </th>
                            <th>Fotos</th>
                            <th>Ubicación</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr class="loading-row">
                            <td colspan="6">
                                <div class="table-loader">
                                    <div class="spinner-small"></div>
                                    <span>Cargando datos...</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <button class="pagination-btn" id="prevBtn" disabled>
                    <svg viewBox="0 0 24 24" width="18" height="18">
                        <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                    </svg>
                    Anterior
                </button>
                <div class="pagination-info">
                    Página <span id="currentPage">1</span> de <span id="totalPages">1</span>
                </div>
                <button class="pagination-btn" id="nextBtn">
                    Siguiente
                    <svg viewBox="0 0 24 24" width="18" height="18">
                        <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                    </svg>
                </button>
            </div>
        </section>

        <!-- Map Section -->
        <section class="map-section" id="mapSection">
            <div class="map-header">
                <h2 class="section-title">Mapa de Ubicaciones</h2>
                <button class="btn-toggle-map" id="toggleMapBtn">
                    <svg viewBox="0 0 24 24" width="18" height="18">
                        <path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                    </svg>
                    <span>Expandir Mapa</span>
                </button>
            </div>
            <div class="map-container" id="map"></div>
        </section>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../shared/js/config.js"></script>
    <script src="../shared/js/utils.js"></script>
    <script src="../shared/js/exports.js"></script>
    <script src="js/admin-dashboard.js"></script>
</body>
</html>